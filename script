from kivy.app import *
from kivy.uix.label import *
from kivy.uix.button import *
from kivy.uix.textinput import *
from kivy.uix.boxlayout import *
from kivy.uix.screenmanager import *
from instructions import *
from ruffier import *


age = 0
name = ''
p1,p2,p3 = 0,0,0
class FirstScr(Screen):
    def __init__(self,**kwargs):
        super().__init__(**kwargs)
        
        vl = BoxLayout(orientation = 'vertical')
        hl1 = BoxLayout(size_hint_y = (1,None), height = '50px')
        hl2 = BoxLayout(size_hint_y = (1,None), height = '50px')
        
        txt = Label(text = txt_instruction)
        txt_name = Label(text = "Enter a name:")
        txt_age = Label(text = "Enter a age:")
        
        self.input_name = TextInput(hint_text = "Enter a name", multiline = False)
        self.input_age = TextInput(hint_text = "Enter a age", multiline = False)
        
        btn = Button(text = 'Next',size_hint_y = (1,None), height = '50px')
        btn.on_press = self.next

        vl.add_widget(txt)

        hl1.add_widget(txt_name)
        hl1.add_widget(self.input_name)

        hl2.add_widget(txt_age)
        hl2.add_widget(self.input_age)

        vl.add_widget(hl1)
        vl.add_widget(hl2)
        vl.add_widget(btn)

        self.add_widget(vl)

    def next(self):
        global name
        global age
        name = self.input_name.text
        age = int(self.input_age.text)
        self.manager.transition.direction = 'left'
        self.manager.current = "second"

class SecondScr(Screen):
    def __init__(self,**kwargs):
        super().__init__(**kwargs)

        vl = BoxLayout(orientation = 'vertical')
        hl = BoxLayout(size_hint_y = (1,None), height = '50px')

        txt = Label(text = txt_test1)
        txt_pulse = Label(text = "Count a pulse:")

        self.input_pulse = TextInput(hint_text= "Enter a pulse", multiline = False)

        btn = Button(text = 'Next',size_hint_y = (1,None), height = '50px')
        btn.on_press = self.next

        vl.add_widget(txt)

        hl.add_widget(txt_pulse)
        hl.add_widget(self.input_pulse)

        vl.add_widget(hl)

        vl.add_widget(btn)

        self.add_widget(vl)

    def next(self):
        global p1
        p1 = int(self.input_pulse.text)
        self.manager.current = "third"

class ThirdScr(Screen):
    def __init__(self,**kwargs):
        super().__init__(**kwargs)

        vl = BoxLayout(orientation = 'vertical')

        txt = Label(text = txt_test2)

        btn = Button(text = 'Next',size_hint_y = (1,None), height = '50px')
        btn.on_press = self.next

        vl.add_widget(txt)
        vl.add_widget(btn)

        self.add_widget(vl)
    
    def next(self):
        self.manager.current = "fourth"

class FourthScr(Screen):
    def __init__(self,**kwargs):
        super().__init__(**kwargs)

        vl = BoxLayout(orientation = 'vertical')

        hl1 = BoxLayout(size_hint_y = (1,None), height = '50px')
        hl2 = BoxLayout(size_hint_y = (1,None), height = '50px')

        txt = Label(text = txt_test2)

        txt_first = Label(text = "First:")
        txt_second = Label(text = "Second:")

        self.input_first = TextInput()
        self.input_second = TextInput()

        btn = Button(text = 'Next',size_hint_y = (1,None), height = '50px')
        btn.on_press = self.next

        vl.add_widget(txt)

        hl1.add_widget(txt_first)
        hl1.add_widget(self.input_first)

        hl2.add_widget(txt_second)
        hl2.add_widget(self.input_second)

        vl.add_widget(hl1)
        vl.add_widget(hl2)

        vl.add_widget(btn)

        self.add_widget(vl)

    def next(self):
        global p2
        global p3
        p2 = int(self.input_first.text)
        p3 = int(self.input_second.text)
        self.manager.current = "fifth"

class FifthScr(Screen):
    def __init__(self,**kwargs):
        super().__init__(**kwargs)

        vl = BoxLayout(orientation = 'vertical')

        self.txt = Label(text = '')

        vl.add_widget(self.txt)

        self.add_widget(vl)

        self.on_enter = self.before
    
    def before(self):
        self.txt.text = name+'\n'+txt_index+ str(ruffier_index(p1, p2, p3)) + '\n'+ txt_workheart + txt_res[ruffier_result(ruffier_index(p1, p2, p3),neud_level(age))]



class MyApp(App):
    def build(self):
        sm = ScreenManager()
        sm.add_widget(FirstScr(name='first'))
        sm.add_widget(SecondScr(name='second'))
        sm.add_widget(ThirdScr(name='third'))
        sm.add_widget(FourthScr(name='fourth'))
        sm.add_widget(FifthScr(name='fifth'))
        return sm

MyApp().run()
